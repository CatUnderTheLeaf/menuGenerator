#:kivy 2.0.0
<ContentNavigationDrawer>:
    orientation: "vertical"
    padding: "8dp"
    spacing: "8dp"
    screen_manager: root.screen_manager
    nav_drawer: root.nav_drawer

    AnchorLayout:
        anchor_x: "left"
        size_hint_y: None
        height: avatar.height

        Image:
            id: avatar
            size_hint: None, None
            size: "56dp", "56dp"
            source: "data/logo/kivy-icon-256.png"

    MDLabel:
        text: "Menu Generator"
        font_style: "Button"
        adaptive_height: True

    ScrollView:
        screen_manager: root.screen_manager
        nav_drawer: root.nav_drawer

        DrawerList:
            id: md_list
            screen_manager: root.screen_manager
            nav_drawer: root.nav_drawer
            
            ItemDrawer:
                text: "Menu"
                text_color: app.theme_cls.primary_color
                cur_screen: "scr1"
                icon: "book-open-variant"

            ItemDrawer:
                text: "Settings"
                cur_screen: "scr2"
                icon: "cog"

            ItemDrawer:
                text: "Recipes"
                cur_screen: "scr3"
                icon: "nutrition"
                on_press: app.get_recipes()
                

<ItemDrawer>:
    theme_text_color: "Custom"
    on_press:
        self.parent.set_color_item(self)
        self.parent.nav_drawer.set_state("close")
        self.parent.screen_manager.current = root.cur_screen
        

    IconLeftWidget:
        icon: root.icon
        theme_text_color: "Custom"
        text_color: root.text_color

<Tab>:
    MDBoxLayout:
        orientation: "vertical"
        
        ScrollView:

            MDGridLayout:
                cols: 1
                adaptive_height: True
                id: box

<Content>:
    size_hint_y: None
    height: recipe_text.height

    MDBoxLayout:
        orientation: "vertical"
        adaptive_height: True

        MDLabel:
            id: recipe_text
            text: root.text

<RecipeSelectionList>:
    id: root.id
    last_selected: False    
    overlay_color: app.overlay_color[:-1] + [.2]
    icon_bg_color: app.overlay_color
    on_selected: app.on_selected(*args)
    on_unselected: app.on_unselected(*args)
    on_selected_mode: app.set_selection_mode(*args)

<RecipeListItem>:
    id: listItem
    text: root.text
    secondary_text: root.secondary_text
    _no_ripple_effect: True
    on_release: app.edit_recipe(root) if not root.parent.selected and not root.parent.owner.selected_mode else root.parent.on_touch_down
    
    ImageLeftWidget:
        source: root.source

<ButtonWithCross>:  
    id: box
    size_hint: None,  None
    height: "26dp"
    padding: "8dp", 0, 0, 0
    width:
        self.minimum_width - (dp(10) if DEVICE_TYPE == "desktop" else dp(20)) \
        if root.icon != 'close' else self.minimum_width

    canvas:
        Color:
            rgba: root.theme_cls.primary_color if not root.color else root.color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: root.radius
    
    MDLabel:
        adaptive_size: True
        -text_size: None, None
        pos_hint: {"center_y": .5}
        id: label
        text: root.text
        size_hint_x: None
        width: self.texture_size[0]
        color: root.text_color if root.text_color else (root.theme_cls.text_color)
        markup: True
    
    MDIconButton:
        id: lbl_ic
        icon: root.icon
        theme_text_color: "Custom"
        adaptive_size: True
        pos_hint: {"center_y": .5}
        on_release: app.removeCustomWidget(root.parentId, root)

<RecipeWidget>:
    id: editRecipe
    orientation: "vertical"
    adaptive_height: True
    padding: dp(48)
    spacing: dp(15)
    
    MDTextField:
        id: recipeTitle
        hint_text: "Title"
        required: True
        helper_text_mode: "on_error"

    MDLabel:
        text: "Ingridients"

    MDStackLayout:
        adaptive_height: True
        spacing: dp(5)
        id: recipeIngridients
    
    MDSeparator:

    MDLabel:
        text: "Prepare time"

    MDStackLayout:
        adaptive_height: True
        spacing: dp(5)
        id: recipePrepareTime

        MDChip:
            text: "short"
            icon: "clock-time-one-outline"
            on_release: app.on_choseChip_check(self, self.text)
            check: True

        MDChip:
            text: "medium"
            icon: "clock-time-five-outline"
            on_release: app.on_choseChip_check(self, self.text)
            check: True

        MDChip:
            text: "long"
            icon: "clock-time-nine-outline"
            on_release: app.on_choseChip_check(self, self.text)
            check: True

    MDSeparator:

    MDGridLayout:
        cols: 2
        adaptive_height: True                            

        MDLabel:
            text: "Repeat dish?"

        MDSwitch:
            id: recipeRepeatDish

    MDSeparator:

    MDTextField:
        id: recipeDescription
        multiline: True
        hint_text: "Prepare instructions"
    
    MDSeparator:
    
    # MDBoxLayout:
    #     # adaptive_height: True
    #     orientation: 'vertical'
    #     spacing: dp(20)
    
    MDLabel:
        text: "Tags"   

    MDStackLayout:
        adaptive_height: True
        spacing: dp(5)
        id: recipeTags 

    MDTextFieldRound:
        id: field
        size_hint_x: None
        width: "200dp"
        hint_text: "New tag"
        on_text: if self.focus: app.refresh(self.text, root)

    RecycleView:
        id: rv
        key_viewclass: 'viewclass'
        key_size: 'height'  
        height: dp(200)          

        RecycleBoxLayout:
            # padding: dp(10)
            default_size: dp(200), dp(48)
            default_size_hint: 0.5, None
            size_hint_y: None
            height: dp(200)
            orientation: 'vertical'
   
    

MDScreen:

    MDBoxLayout:
        orientation: "vertical"
        
        MDNavigationLayout:

            ScreenManager:
                id: screen_manager
                
                MDScreen:   
                    name: "scr1"
                    
                    MDBoxLayout:
                        orientation: "vertical"

                        MDToolbar:
                            id: menu
                            pos_hint: {"top": 1}
                            title: "Menu"
                            left_action_items: [["menu", lambda x: nav_drawer.set_state("open")]]
                            right_action_items: [["refresh", lambda x: app.generateMenuTabs(), "reGenerate Menu"]]


                        MDTabs:
                            id: tabs
                            on_tab_switch: app.on_tab_switch(*args)
                
                MDScreen:
                    name: "scr2"

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(5)

                        MDToolbar:
                            id: settings
                            pos_hint: {"top": 1}
                            title: "Settings"
                            left_action_items: [["menu", lambda x: nav_drawer.set_state("open")]]

                        ScrollView:
                            
                            MDGridLayout:
                                padding: dp(20)
                                spacing: dp(10)
                                cols: 1
                                adaptive_height: True
                                
                                MDLabel:
                                    text: "Time period"
                                    
                                Widget:
                                    size_hint_y: None
                                    height: dp(5)
                                
                                MDStackLayout:
                                    adaptive_height: True
                                    spacing: dp(5)
                                    id: timePeriod

                                    MDChip:
                                        text: "day"
                                        icon: "calendar-today"
                                        on_release: 
                                            app.on_choseChip_check(self, self.text)
                                            app.set_n_days(self.text)
                                        check: True

                                    MDChip:
                                        text: "week"
                                        icon: "calendar-week"
                                        on_release: 
                                            app.on_choseChip_check(self, self.text)
                                            app.set_n_days(self.text)
                                        check: True

                                    MDChip:
                                        text: "month"
                                        icon: "calendar-month"
                                        on_release: 
                                            app.on_choseChip_check(self, self.text)
                                            app.set_n_days(self.text)
                                        check: True
                                
                                MDSeparator:
                                
                                MDGridLayout:
                                    cols: 2
                                    adaptive_height: True                            

                                    MDLabel:
                                        text: "Repeat dishes"

                                    MDSwitch:
                                        id: repeatDishes
                                        on_active: app.on_repeat_switch(*args)                                    
                                
                                MDSeparator:
                                
                                Widget:
                                    size_hint_y: None
                                    height: dp(5)
                            
                                MDLabel:
                                    text: "Meals"

                                Widget:
                                    size_hint_y: None
                                    height: dp(5)

                                MDGridLayout:
                                    cols: 1
                                    adaptive_height: True
                                    spacing: dp(5)
                                    id: meals                                

                                    MDChip:
                                        text: "Breakfast"                                    
                                        icon: "bowl-mix"
                                        value: 0
                                        on_release: app.on_meal_check(self, self.value)
                                        check: True

                                    MDChip:
                                        text: "Brunch"
                                        icon: "food-variant"
                                        value: 1
                                        on_release: app.on_meal_check(self, self.value)
                                        check: True

                                    MDChip:
                                        text: "Lunch"
                                        icon: "pasta"
                                        value: 2
                                        on_release: app.on_meal_check(self, self.value)
                                        check: True
                                    
                                    MDChip:
                                        text: "Supper"
                                        icon: "pot-steam"
                                        value: 3
                                        on_release: app.on_meal_check(self, self.value)
                                        check: True

                                    MDChip:
                                        text: "Dinner"
                                        icon: "noodles"
                                        value: 4
                                        on_release: app.on_meal_check(self, self.value)
                                        check: True                                
                                
                                MDSeparator:

                MDScreen:
                    name: "scr3"
                    
                    MDBoxLayout:
                        orientation: "vertical"
            
                        MDToolbar:
                            id: recipeListToolbar
                            pos_hint: {"top": 1} 
                            title: "All recipes"
                            left_action_items: [["menu", lambda x: nav_drawer.set_state("open")]]
                            

                        ScrollView:

                            RecipeSelectionList:
                                id: recipe_scroll
                            
                        
                    MDFloatingActionButton:
                        icon: "plus"
                        theme_text_color: "Custom"
                        elevation_normal: 12
                        y: dp(10)
                        x: Window.width - (dp(56) + dp(10))
                        on_release: app.edit_recipe()

                MDScreen:
                    name: "scr4"
                    
                    MDBoxLayout:
                        orientation: "vertical"
            
                        MDToolbar:
                            id: editRecipeBar
                            pos_hint: {"top": 1} 
                            title: "Edit recipe"
                            left_action_items: [["arrow-left", lambda x: app.returnBack()]]
                            right_action_items: [["check", lambda x: app.saveRecipe(editRecipeScroll.children[0]), "save"]]


                        ScrollView:
                            id: editRecipeScroll
                                
                                
                
            MDNavigationDrawer:
                id: nav_drawer

                ContentNavigationDrawer:
                    screen_manager: screen_manager
                    nav_drawer: nav_drawer